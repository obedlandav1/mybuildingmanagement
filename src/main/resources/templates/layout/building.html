<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path=""
    data-template="vertical-menu-template-free">

<head th:replace="~{fragments/head :: head('Edificios')}"></head>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">

            <!-- Sidebar -->
            <div th:replace="~{fragments/sidebar :: sidebar}"></div>
            <!-- / Sidebar -->

            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->
                <div th:replace="~{fragments/navbar :: navbar}"></div>
                <!-- / Navbar -->

                <!-- Content wrapper -->
                <div class="content-wrapper">

                    <!-- Content -->
                    <div class="container-xxl flex-grow-1 container-p-y" id="app" v-cloak>
                        <div class="align-items-center d-flex justify-content-between mt-0 mb-4">
                            <h4 class="fw-bold py-0 mb-0"><span class="text-muted fw-light">Registro /</span> Edificios
                            </h4>
                            <a th:href="@{/building-create}">
                                <button type="button" class="btn btn-primary">Crear</button>
                            </a>
                        </div>
                        <!-- Basic Bootstrap Table -->
                        <div class="card">
                            <h5 class="card-header">Registro</h5>
                            <div class="table-responsive text-nowrap">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Nombre</th>
                                            <th>Dirección</th>
                                            <th>Ruc</th>
                                            <th>Pais</th>
                                            <th>Estado</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody class="table-border-bottom-0">
                                        <tr v-for="e in edificios" :key="e.idedificio">
                                            <td><strong>{{ e.nombre_edificio }}</strong></td>
                                            <td>{{ e.direccion_edificio }}</td>
                                            <td>{{ e.ruc }}</td>
                                            <td>{{ e.pais_edificio }}</td>
                                            <td>
                                                <!--<span class="badge bg-label-primary me-1">{{ e.estado_edificio }}</span>-->
                                                <span class="badge me-1"
                                                    :class="getEstadoInfo(e.estado_edificio).clase">
                                                    {{ getEstadoInfo(e.estado_edificio).texto }}
                                                </span>
                                            </td>
                                            <td>
                                                <div class="dropdown dropstart">
                                                    <button type="button" class="btn p-0 dropdown-toggle hide-arrow"
                                                        data-bs-toggle="dropdown">
                                                        <i class="bx bx-dots-vertical-rounded"></i>
                                                    </button>
                                                    <div class="dropdown-menu">
                                                        <a :href="'/building/' + e.idedificio + '/inmuebles'"
                                                            class="dropdown-item">
                                                            <i class="bx bx-show me-1"></i> Inmuebles
                                                        </a>
                                                        <a :href="'/building/' + e.idedificio + '/propietarios'"
                                                            class="dropdown-item">
                                                            <i class="bx bx-user me-1"></i> Propietarios
                                                        </a>
                                                        <a :href="'/building-edit/' + e.idedificio"
                                                            class="dropdown-item">
                                                            <i class="bx bx-edit-alt me-1"></i> Editar
                                                        </a>
                                                        <a href="javascript:void(0);" class="dropdown-item"
                                                            @click="prepararEliminar(e.idedificio)">
                                                            <i class="bx bx-trash me-1"></i> Eliminar
                                                        </a>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!--/ Basic Bootstrap Table -->

                        <!-- Cargando -->
                        <div v-if="cargando" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status"></div>
                            <p class="mt-2 text-muted">Cargando edificios...</p>
                        </div>

                        <!-- No hay datos -->
                        <div v-if="!cargando && edificios.length === 0" class="alert alert-danger w-100" role="alert">
                            No existen datos que mostrar
                        </div>

                        <!-- Toggle Between Modals -->
                        <div class="col-lg-4 col-md-6">
                            <div class="mt-3">
                                <!-- Modal 1-->
                                <div class="modal fade" id="modalToggle" aria-labelledby="modalToggleLabel"
                                    tabindex="-1" style="display: none" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="modalToggleLabel">Eliminar Edificio</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body">¿Desea eliminar el edificio? Esta acción no se puede
                                                deshacer</div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-outline-secondary"
                                                    data-bs-dismiss="modal">Cancelar</button>
                                                <button type="button" @click="confirmarEliminar"
                                                    class="btn btn-primary">Eliminar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- / Toggle Between Modals -->

                    </div>
                    <!-- / Content -->

                    <!-- Footer -->
                    <div th:replace="~{fragments/footer :: footer}"></div>
                    <!-- / Footer -->

                    <div class="content-backdrop fade"></div>
                </div>
                <!-- Content wrapper -->
            </div>
            <!-- / Layout page -->
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>
    </div>

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script th:src="@{/vendor/libs/jquery/jquery.js}"></script>
    <script th:src="@{/vendor/libs/popper/popper.js}"></script>
    <script th:src="@{/vendor/js/bootstrap.js}"></script>
    <script th:src="@{/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>

    <script th:src="@{/vendor/js/menu.js}"></script>
    <!-- endbuild -->

    <!-- Vendors JS -->
    <script th:src="@{/vendor/libs/apex-charts/apexcharts.js}"></script>

    <!-- Main JS -->
    <script th:src="@{/js/main-app.js}"></script>

    <!-- Page JS -->
    <script th:src="@{/js/dashboards-analytics.js}"></script>

    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <!-- Vue JS -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>

    <script>
        new Vue({
            el: "#app",
            data: {
                edificios: [],
                cargando: false,
                error: null,
                idedificio: null
            },
            methods: {
                listar: function () {
                    this.cargando = true;
                    this.$http.get('/api/edificio').then(response => {
                        this.edificios = response.body;
                        this.cargando = false;
                    }).catch(err => {
                        console.error(err);
                        this.error = "Error al cargar los edificios.";
                        this.cargando = false;
                    });
                },
                getEstadoInfo: function (codigo) {
                    switch (codigo) {
                        case 1:
                            return { texto: "Activo", clase: "bg-label-success" };
                        case 2:
                            return { texto: "Suspendido", clase: "bg-label-warning" };
                        case 3:
                            return { texto: "Eliminado", clase: "bg-label-danger" };
                        default:
                            return { texto: "Desconocido", clase: "bg-label-secondary" };
                    }
                },
                prepararEliminar: function (id) {
                    this.idedificio = id;
                    $("#modalToggle").modal("show");
                },
                confirmarEliminar: function () {
                    this.$http.delete(`/api/edificio/${this.idedificio}`)
                        .then(() => {
                            this.listar();
                            $("#modalToggle").modal("hide");
                        })
                        .catch(err => {
                            console.error(err);
                            alert("Error al eliminar el edificio.");
                        });
                }
            },
            mounted: function () {
                this.listar();
            }
        });
    </script>

</body>

</html>