<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path=""
    data-template="vertical-menu-template-free">

<head th:replace="~{fragments/head :: head('Crear edificio')}"></head>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">

            <!-- Sidebar -->
            <div th:replace="~{fragments/sidebar :: administrator}"></div>
            <!-- / Sidebar -->

            <!-- Layout container -->
            <div class="layout-page" id="app" v-cloak>
                <!-- Navbar -->
                <div th:replace="~{fragments/navbar :: navbar}"></div>
                <!-- / Navbar -->

                <!-- Content wrapper -->
                <div class="content-wrapper">

                    <!-- Content -->
                    <div class="container-xxl flex-grow-1 container-p-y">
                        <div class="align-items-center d-flex justify-content-between mt-0 mb-4">
                            <h4 class="fw-bold py-0 mb-0"><span class="text-muted fw-light">Crear /</span> Cliente
                            </h4>
                            <a th:href="@{/administrator/client}">
                                <button type="button" class="btn btn-primary">Regresar</button>
                            </a>
                        </div>
                        <!-- Basic Layout -->
                        <div class="col-xxl">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <form @submit.prevent="guardar">
                                        <div class="row mb-3">
                                            <label class="col-sm-2 col-form-label">Nombre o Razon</label>
                                            <div class="col-sm-10">
                                                <input v-model="cliente.razon_cliente" type="text" class="form-control"
                                                    placeholder="Ingrese nombre o razon del cliente" required />
                                            </div>
                                        </div>

                                        <div class="row mb-3">
                                            <label class="col-sm-2 col-form-label">Num. de identidad</label>
                                            <div class="col-sm-10">
                                                <input v-model="cliente.num_identidad" type="text" class="form-control"
                                                    placeholder="Ingrese el numero de identidad del cliente" required />
                                            </div>
                                        </div>

                                        <div class="row mb-3">
                                            <label class="col-sm-2 col-form-label">Dirección de cliente</label>
                                            <div class="col-sm-10">
                                                <input v-model="cliente.direccion_cliente" type="text"
                                                    class="form-control"
                                                    placeholder="Ingrese la dirección del cliente" />
                                            </div>
                                        </div>

                                        <!--<div class="row mb-3">
                                            <label class="col-sm-2 col-form-label">Estado</label>
                                            <div class="col-sm-10">
                                                <input v-model="cliente.pais_edificio" type="text" class="form-control"
                                                    placeholder="Ingrese la dirección del cliente" required />
                                            </div>
                                        </div>-->
                                        <div class="row justify-content-end">
                                            <div class="col-sm-10">
                                                <button type="submit" class="btn btn-primary">Guardar</button>
                                            </div>
                                        </div>
                                    </form>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- / Content -->

                <!-- Toggle Between Modals -->
                <div class="col-lg-4 col-md-6">
                    <div class="mt-3">
                        <div class="modal fade" id="modalToggle" aria-labelledby="modalToggleLabel" tabindex="-1"
                            style="display: none" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="modalToggleLabel">{{ modalTitulo }}</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p :class="modalClase">{{ modalMensaje }}</p>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-primary"
                                            data-bs-dismiss="modal">Aceptar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- / Toggle Between Modals -->

                    <!-- Footer -->
                    <div th:replace="~{fragments/footer :: footer}"></div>
                    <!-- / Footer -->

                    <div class="content-backdrop fade"></div>
                </div>
                <!-- Content wrapper -->
            </div>
            <!-- / Layout page -->
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>
    </div>

    <div th:replace="~{fragments/scripts :: scripts}"></div>

    <script>
        new Vue({
            el: "#app",
            data: {
                cliente: {
                    razon_cliente: "",
                    num_identidad: "",
                    direccion_cliente: "",
                    estado_cliente: 1
                },
                modalTitulo: '',
                modalMensaje: '',
                modalTipo: '',
                mensaje: null,
                error: null
            },
            methods: {
                mostrarModal(titulo, mensaje, tipo) {
                    this.modalTitulo = titulo;
                    this.modalMensaje = mensaje;
                    this.modalClase = tipo;
                    $("#modalToggle").modal("show");
                },
                guardar: function () {
                    this.mensaje = null;
                    this.error = null;
                    this.$http.post('/api/cliente', this.cliente)
                        .then(response => {
                            console.log(response.status);
                            switch (response.status) {
                                case 201:
                                    this.mostrarModal('Aviso', 'Se registro el cliente correctamente. Redirigiendo...', 'text-success');
                                    setTimeout(() => {
                                        $("#modalToggle").modal("hide");
                                        window.location.href = '/administrator/client';
                                    }, 1500);
                                    break;
                                default:
                                    this.mostrarModal('Error inesperado', 'Ha ocurrido un problema en el servidor.', 'text-muted');
                                    break;
                            }
                        })
                        .catch(err => {
                            console.error(err);
                            this.error = "❌ Error al registrar el cliente.";
                        });
                },
                limpiarFormulario: function () {
                    this.edificio = {
                        razon_cliente: "",
                        num_identidad: "",
                        direccion_cliente: "",
                        estado_cliente: ""
                    };
                }
            }
        });
    </script>
</body>

</html>