<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path=""
    data-template="vertical-menu-template-free">

<head th:replace="~{fragments/head :: head('Crear edificio')}"></head>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">

            <!-- Sidebar -->
            <div th:replace="~{fragments/sidebar :: sidebar}"></div>
            <!-- / Sidebar -->

            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->
                <div th:replace="~{fragments/navbar :: navbar}"></div>
                <!-- / Navbar -->

                <!-- Content wrapper -->
                <div class="content-wrapper">

                    <!-- Content -->
                    <div class="container-xxl flex-grow-1 container-p-y" id="app" v-cloak>
                        <div class="align-items-center d-flex justify-content-between mt-0 mb-4">
                            <h4 class="fw-bold py-0 mb-0"><span class="text-muted fw-light">Crear /</span> Edificio
                            </h4>
                            <a th:href="@{/building}">
                                <button type="button" class="btn btn-primary">Regresar</button>
                            </a>
                        </div>
                        <!-- Basic Layout -->
                        <div class="col-xxl">
                            <div class="card mb-4">
                                <!--<div class="card-header d-flex align-items-center justify-content-between">
                                    <h5 class="mb-0">Basic Layout</h5>
                                    <small class="text-muted float-end">Default label</small>
                                </div>-->
                                <div class="card-body">
                                    <form @submit.prevent="guardar">
                                        <div class="row mb-3">
                                            <label class="col-sm-2 col-form-label">Nombre</label>
                                            <div class="col-sm-10">
                                                <input v-model="edificio.nombre_edificio" type="text"
                                                    class="form-control" placeholder="Ingrese nombre del edificio"
                                                    required />
                                            </div>
                                        </div>

                                        <div class="row mb-3">
                                            <label class="col-sm-2 col-form-label">Dirección</label>
                                            <div class="col-sm-10">
                                                <input v-model="edificio.direccion_edificio" type="text"
                                                    class="form-control" placeholder="Ingrese dirección completa"
                                                    required />
                                            </div>
                                        </div>

                                        <div class="row mb-3">
                                            <label class="col-sm-2 col-form-label">RUC</label>
                                            <div class="col-sm-10">
                                                <input v-model="edificio.ruc" type="text" class="form-control"
                                                    placeholder="Opcional" />
                                            </div>
                                        </div>

                                        <div class="row mb-3">
                                            <label class="col-sm-2 col-form-label">País</label>
                                            <div class="col-sm-10">
                                                <input v-model="edificio.pais_edificio" type="text" class="form-control"
                                                    placeholder="Ingrese el país" required />
                                            </div>
                                        </div>

                                        <!--<div class="row mb-3">
                                            <label class="col-sm-2 col-form-label">Estado</label>
                                            <div class="col-sm-10">
                                                <select v-model="edificio.estado_edificio" class="form-select" required>
                                                    <option disabled value="">Seleccione un estado</option>
                                                    <option value="1">Activo</option>
                                                    <option value="2">Suspendido</option>
                                                    <option value="3">Eliminado</option>
                                                </select>
                                            </div>
                                        </div>-->

                                        <div class="row justify-content-end">
                                            <div class="col-sm-10">
                                                <button type="submit" class="btn btn-primary">Guardar</button>
                                            </div>
                                        </div>
                                    </form>

                                    <!-- Mensaje de éxito -->
                                    <div v-if="mensaje" class="alert alert-success mt-3">
                                        {{ mensaje }}
                                    </div>

                                    <!-- Mensaje de error -->
                                    <div v-if="error" class="alert alert-danger mt-3">
                                        {{ error }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- / Content -->

                <!-- Footer -->
                <div th:replace="~{fragments/footer :: footer}"></div>
                <!-- / Footer -->

                <div class="content-backdrop fade"></div>
            </div>
            <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
    </div>

    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
    </div>

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script th:src="@{/vendor/libs/jquery/jquery.js}"></script>
    <script th:src="@{/vendor/libs/popper/popper.js}"></script>
    <script th:src="@{/vendor/js/bootstrap.js}"></script>
    <script th:src="@{/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>

    <script th:src="@{/vendor/js/menu.js}"></script>
    <!-- endbuild -->

    <!-- Vendors JS -->
    <script th:src="@{/vendor/libs/apex-charts/apexcharts.js}"></script>

    <!-- Main JS -->
    <script th:src="@{/js/main-app.js}"></script>

    <!-- Page JS -->
    <script th:src="@{/js/dashboards-analytics.js}"></script>

    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <!-- Vue JS -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-resource@1.5.1"></script>

    <script>
        new Vue({
            el: "#app",
            data: {
                edificio: {
                    nombre_edificio: "",
                    direccion_edificio: "",
                    ruc: "",
                    pais_edificio: "",
                    estado_edificio: 1
                },
                mensaje: null,
                error: null
            },
            methods: {
                guardar: function () {
                    this.mensaje = null;
                    this.error = null;
                    this.$http.post('/api/edificio', this.edificio)
                        .then(response => {
                            this.mensaje = "✅ Edificio creado correctamente.";
                            this.limpiarFormulario();  
                            
                            // Esperar 1.5 segundos y redirigir
                            setTimeout(() => {
                                window.location.href = "/building"; // URL de la lista
                            }, 1500);
                        })
                        .catch(err => {
                            console.error(err);
                            this.error = "❌ Error al registrar el edificio.";
                        });
                },
                limpiarFormulario: function () {
                    this.edificio = {
                        nombre_edificio: "",
                        direccion_edificio: "",
                        ruc: "",
                        pais_edificio: ""
                    };
                }
            }
        });
    </script>
</body>

</html>